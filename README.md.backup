# atmaCup22 - Basketball Player Re-identification

## ðŸš€ NEW: Performance Optimization (Dec 2025)

**Significant speed improvements added!** Training is now **6-10x faster** for data loading.

### Quick Start (3 Steps)

1. **Generate negatives once:**
   ```bash
   python 00_prepare_negatives.py
   ```

2. **Update training to use pre-computed negatives:**
   ```python
   known, unknown, _, _ = build_open_set_splits_cv(
       ...,
       use_precomputed_negatives=True,
       neg_csv_path="inputs/train_negatives.csv"
   )
   ```

3. **Increase DataLoader workers:**
   ```python
   datamodule = PlayerReIDDataModuleCV(..., num_workers=8)
   ```

**Results:**
- Data loading: <1 min (was 5-7 mins) âœ…
- Each epoch: 50-70% faster âœ…
- Total saved: 10-20 minutes per run âœ…

ðŸ“– **Full guide:** [OPTIMIZATION_SUMMARY.md](OPTIMIZATION_SUMMARY.md)

---

## Training Strategy

4. Data balance trong training (chi tiáº¿t hÆ¡n)

TÃ³m láº¡i quan Ä‘iá»ƒm:

Train domain chÃ­nh (side) tháº­t cháº¯c, multi-view chá»‰ fine-tune nháº¹ nhÃ ng.

Cá»¥ thá»ƒ:

Stage 1 â€“ side-only, full epochs

Data: táº¥t cáº£ sample angle="side".

Epoch: 15â€“30 tuá»³ tÃ i nguyÃªn.

Loss: ArcFace + Triplet.

Stage 2 â€“ multi-view fine-tune, Ã­t epochs

Data: MultiViewPlayerReIDDataModule (sideâ€“top pairs).

Epoch: 3â€“5.

LR nhá»: 3eâ€‘5.

Loss weight:

Side: full.

Top: 0.5.

Consistency: 0.1.

Gallery + threshold + inference

Gallery tá»« side-only (hoáº·c side-dominant).

Threshold tune trÃªn side.

Inference dÃ¹ng side tracklet + frame constraint.

Top = optional bonus.

5. TÃ³m ngáº¯n gá»n Ä‘á»ƒ báº¡n Ã¡p dá»¥ng

KhÃ´ng train model â€œcÃ¢nâ€ top & side nhÆ° nhau, vÃ¬ test lá»‡ch háº³n vá» side.

LÃ m 2 stage:

Stage 1: ReID side-only.

Stage 2: multi-view fine-tune vá»›i weight nhá» cho top + consistency.

Trong gallery + open-set, chá»‰ / chá»§ yáº¿u dÃ¹ng side.

Inference test: pipeline side-only váº«n Ä‘Ãºng; top chá»‰ dÃ¹ng sau nÃ y nhÆ° â€œcheckâ€.

Náº¿u báº¡n muá»‘n, mÃ¬nh cÃ³ thá»ƒ sá»­a trá»±c tiáº¿p cÃ¡c Ä‘oáº¡n code cá»¥ thá»ƒ (vd sá»­a datamodule.py vÃ  inference.py vá»›i filter angle == 'side' + loss weight multi-view nhÆ° mÃ¬nh mÃ´ táº£, theo Ä‘Ãºng style code báº¡n Ä‘ang dÃ¹ng).